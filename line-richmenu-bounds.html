<!doctype html><html><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title></title><script src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-39556213-3");</script><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><style>[v-cloak]{display:none}.richmenu{background-repeat:no-repeat;background-size:cover;border:1px dashed gray;height:0;overflow:hidden;position:relative}.area{border:1px dashed red;color:red;font-size:.8rem;position:absolute;top:0;left:0}.resizable{border:1px solid #00f;position:absolute;touch-action:none;top:0;left:0}.input-group-sm .input-group-text{letter-spacing:-1px;min-width:5.5rem}</style></head><body><div class="container py-3 text-monospace" id="app" v-cloak><div class="row mb-3"><div class="col was-validated"><div class="input-group input-group-sm mb-2"><div class="input-group-prepend"><span class="input-group-text justify-content-end">image</span></div><input class="form-control" required type="url" v-model="h.image" inputmode="url" pattern="(https?|line)://.+"></div><div class="row mx-n1 mb-2"><div class="col px-1"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-end">imgWidth</span></div><input class="form-control" required type="number" v-model="h.imgWidth"></div></div><div class="col px-1"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-end">imgHeight</span></div><input class="form-control" required type="number" v-model="h.imgHeight"></div></div></div><div class="row mx-n1 mb-2"><div class="col px-1"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-end">x</span></div><input class="form-control" required type="number" v-model="h.resizable.x"></div></div><div class="col px-1"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-end">width</span></div><input class="form-control" required type="number" v-model="h.resizable.width"></div></div></div><div class="row mx-n1"><div class="col px-1"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-end">y</span></div><input class="form-control" required type="number" v-model="h.resizable.y"></div></div><div class="col px-1"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-end">height</span></div><input class="form-control" required type="number" v-model="h.resizable.height"></div></div></div></div><div class="col d-flex flex-column"><div class="input-group input-group-sm flex-fill"><div class="input-group-prepend"><span class="input-group-text align-items-center flex-column justify-content-center">areas<br><span class="badge badge-primary d-inline-block">{{ areas.length }}</span></span></div><textarea class="form-control form-control-sm" id="areas" v-model="h.areas"></textarea></div><div class="row mx-n1 mt-2"><div class="col px-1"><button @click="btnPopArea" class="btn btn-block btn-sm btn-danger" type="button">Pop</button></div><div class="col px-1"><button @click="btnPushArea" class="btn btn-block btn-sm btn-success" type="button">Push</button></div></div></div></div><div class="richmenu" :style="styleRichmenu" ref="richmenu"><div class="align-items-center justify-content-center area d-flex" :style="styleArea(area)" v-for="area, idx in areas">({{ _.parseInt(idx) + 1 }}) {{ area.x }},{{ area.width }},{{ area.y }},{{ area.height }}</div><div class="resizable" :style="styleArea(h.resizable)"></div></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/interactjs@1/dist/interact.min.js" crossorigin="anonymous"></script><script>window.RICHMENU_ALIAS="RICHMENU_ALIAS",window.httpBuildQuery=(t,e={})=>Qs.stringify(t,{arrayFormat:"brackets",...e}),window.vm=new Vue({el:"#app",data:{h:{areas:"",image:"https://i.imgur.com/uTSeCeQ.png",imgHeight:400,imgWidth:800,resizable:{x:0,width:800,y:0,height:400}}},async mounted(){try{var t=JSON5.parse(localStorage.getItem(location.pathname));t&&this.$set(this,"h",{...this.h,...t})}catch(t){}this.$watch("h",()=>{localStorage.setItem(location.pathname,JSON5.stringify(this.h))},{deep:!0}),this.$watch("h.image",async(t,e)=>{try{if(t===e)return;var i=await this.getImageUrlSize(this.h.image);[this.h.imgHeight,this.h.imgWidth]=[i.height,i.width]}catch(t){}});window.interact(".resizable").resizable({edges:{top:!0,left:!0,bottom:!0,right:!0},invert:"reposition",listeners:{move:t=>{var t=t["deltaRect"],e={h:(e=this.h).imgHeight,w:e.imgWidth},i={h:(i=this.$refs.richmenu).clientHeight,w:i.clientWidth};const h=e.w/i.w,a=e.h/i.h;i=this.h.resizable;this.$set(this.h,"resizable",((t,e)=>{for(const i of[["x","width","w"],["y","height","h"]])t[i[0]]<0&&(t[i[1]]=t[i[1]]+t[i[0]],t[i[0]]=0),t[i[0]]=_.clamp(t[i[0]],0,e[i[2]]),t[i[1]]=_.clamp(t[i[1]],0,e[i[2]]-t[i[0]]);return t})({x:i.x+t.left*h,y:i.y+t.top*a,width:i.width+t.width*h,height:i.height+t.height*a},e))}}})},computed:{styleRichmenu(){return{backgroundImage:`url(${this.h.image})`,paddingTop:this.h.imgHeight/this.h.imgWidth*100+"%"}},areas(){try{return _.get(Papa.parse(_.trim(this.h.areas),{encoding:"utf8",header:!0}),"data",[])}catch(t){return[]}}},methods:{styleArea(t){var e=_.pick(this.h,["imgHeight","imgWidth"]),i=_.pick(this.$refs.richmenu,["clientHeight","clientWidth"]);const h=i.clientWidth/e.imgWidth,a=i.clientHeight/e.imgHeight;return{height:t.height*a+"px",width:t.width*h+"px",transform:`translate(${t.x*h}px, ${t.y*a}px)`}},async getImageUrlSize(h){if(h)return new Promise((t,e)=>{const i=new Image;i.onload=function(){t({height:this.height,width:this.width})},i.onerror=function(t){console.error(t),e(new Error("無法取得圖片大小"))},i.src=h});throw new Error("url is required")},async btnPushArea(){var t=[...this.areas,_.mapValues(_.pick(this.h.resizable,["x","width","y","height"]),_.toSafeInteger)];this.h.areas=Papa.unparse(t,{header:!0})},async btnPopArea(){if(this.areas.length){const e=[...this.areas];var t=_.first(e.splice(-1,1));this.$set(this.h,"resizable",t),this.h.areas=Papa.unparse(e,{header:!0})}},importAreas(t){this.$set(this.h,"areas",Papa.unparse(_.map(t,"bounds"),{header:!0}))}}});</script></body></html>