<!doctype html><html><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>Inspect iPass</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-39556213-3");</script><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><style>[v-cloak]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,body,h1,h2,h3,h4,h5,h6{font-family:"Noto Sans TC",sans-serif}#card,#card input.form-control{letter-spacing:-1px}#card textarea.form-control{font-size:12px}#card .input-group-prepend .input-group-text{letter-spacing:-2px;min-width:80px}</style></head><body><div class="container-fluid my-3" id="app" v-cloak><h2 class="text-center mb-3">Inspect iPass</h2><div class="d-flex flex-column flex-md-row text-monospace" id="card"><div class="mr-sm-3"><div class="form-group"><label>產生轉乘交易</label><div class="mx-n1 row"><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">轉乘時間</span></div><input class="form-control" v-model="h.xferTime"><div class="input-group-append"><button class="btn btn-outline-secondary rounded-right" type="button" data-toggle="dropdown"><i class="fa fa-chevron-down"></i></button><div class="dropdown-menu dropdown-menu-right"><button class="dropdown-item" type="button" @click="btnSetXferTimeBeforeNow(10)">距今 10 分鐘前</button><button class="dropdown-item" type="button" @click="btnSetXferTimeBeforeNow(82)">距今 82 分鐘前</button></div></div></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">扣款金額</span></div><input class="form-control" type="number" v-model.number="h.xferCost"></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">轉乘群組</span></div><select class="form-control" v-model="h.xferGroup"><option :value="pair[0]" v-for="pair of _.sortBy(_.toPairs(ipass?.xferGroups), 0)">0x{{ pair[0] }}: {{ pair[1] }}</option></select></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><button class="btn btn-block btn-primary btn-sm" type="button" @click="btnMakeTxnWithXfer">複製 EML</button></div></div></div><div class="form-group"><label>卡片基本資料</label><div class="mx-n1 row"><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">公車卡別</span></div><input class="form-control" :value="card?.busCardType" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">加值上限</span></div><input class="form-control" :value="card?.autoloadQuota" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">加值日期</span></div><input class="form-control" :value="card?.autoloadDate" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">加值次數</span></div><input class="form-control" :value="card?.autoloadCnt" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">加值旗標</span></div><input class="form-control" :value="card?.autoload" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">卡片效期</span></div><input class="form-control" :value="card?.exp" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">卡片編號</span></div><input class="form-control" :value="card?.uid" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">交易序號</span></div><input class="form-control" :value="card?.ctsn" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">企業代碼</span></div><input class="form-control" :value="card?.enterpriseId" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">每次加值</span></div><input class="form-control" :value="card?.autoloadUnit" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">身份別</span></div><input class="form-control" :value="card?.profileType" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">身份到期</span></div><input class="form-control" :value="card?.profileExp" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">社福上限</span></div><input class="form-control" :value="card?.welfareLimit" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">社福已用</span></div><input class="form-control" :value="card?.welfareUsed" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">社福日期</span></div><input class="form-control" :value="card?.welfareDate" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">社福機構</span></div><input class="form-control" :value="card?.welfareProvider" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">社福類別</span></div><input class="form-control" :value="card?.welfareIdentity" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">旅遊卡天數</span></div><input class="form-control" :value="card?.travelDay" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">旅遊卡效期</span></div><input class="form-control" :value="card?.travelExpire" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">記名旗標</span></div><input class="form-control" :value="card?.isRegister" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">記名識別碼</span></div><input class="form-control" :value="card?.registerId" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">區碼</span></div><input class="form-control" :value="card?.area" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">票卡版本</span></div><input class="form-control" :value="card?.version" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">票卡狀態</span></div><input class="form-control" :value="card?.status" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">票卡種類</span></div><input class="form-control" :value="card?.type" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">單次限額</span></div><input class="form-control" :value="card?.quotaTxn" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">發卡時間</span></div><input class="form-control" :value="card?.issued" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">發卡單位</span></div><input class="form-control" :value="card?.issuer" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">銀行代碼</span></div><input class="form-control" :value="card?.bank" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">餘額</span></div><input class="form-control" :value="card?.ev" readonly></div></div></div></div><div class="form-group"><label>轉乘紀錄</label><div class="mx-n1 row"><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">交易序號</span></div><input class="form-control" :value="card?.xfer?.txn?.ctsn" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">轉乘時間</span></div><input class="form-control" :value="card?.xfer?.time" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">轉乘前群組</span></div><input class="form-control" :value="card?.xfer?.before" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">轉乘後群組</span></div><input class="form-control" :value="card?.xfer?.after" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">轉乘類別</span></div><input class="form-control" :value="card?.xfer?.type" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">系統</span></div><input class="form-control" :value="card?.xfer?.system" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">業者</span></div><input class="form-control" :value="card?.xfer?.location" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">設備編號</span></div><input class="form-control" :value="card?.xfer?.device" readonly></div></div></div></div><div class="form-group" v-for="txn of [card?.credit]"><label>最近加值交易</label><div class="mx-n1 row"><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">交易序號</span></div><input class="form-control" :value="txn?.ctsn" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">時間</span></div><input class="form-control" :value="txn?.time" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">交易類別</span></div><input class="form-control" :value="txn?.type" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">加值金額</span></div><input class="form-control" :value="txn?.amount" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">餘額</span></div><input class="form-control" :value="txn?.ev" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">系統</span></div><input class="form-control" :value="txn?.system" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">業者</span></div><input class="form-control" :value="txn?.spid" readonly></div></div><div class="col-12 col-md-6 mb-1 px-1 col-lg-4 col-xl-3"><div class="input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-center">設備</span></div><input class="form-control" :value="txn?.device" readonly></div></div></div></div><div class="form-group"><label>最近扣款交易</label><div class="table-responsive"><table class="text-center table table-bordered table-sm table-striped"><thead><tr class="text-nowrap"><th>#</th><th>時間</th><th>類別</th><th>扣款</th><th>餘額</th><th>系統</th><th>業者</th><th>設備</th></tr></thead><tbody><tr v-for="txn of card?.deducts"><th>{{ txn?.ctsn }}</th><td>{{ txn?.time }}</td><td>{{ txn?.type }}</td><td>{{ txn?.amount }}</td><td>{{ txn?.ev }}</td><td>{{ txn?.system }}</td><td>{{ txn?.spid }}</td><td>{{ txn?.device }}</td></tr></tbody></table></div></div><div class="form-group"><label>Mifare 卡片金鑰</label><div class="mx-n1 row"><div class="col-12 col-md-6 mb-1 px-1"><div class="input-group input-group-sm" @click="btnCopy(card?.keya)"><div class="input-group-prepend"><span class="input-group-text justify-content-center">keyA</span></div><textarea class="form-control" rows="16" :value="card?.keya" readonly></textarea></div></div><div class="col-12 col-md-6 mb-1 px-1"><div class="input-group input-group-sm" @click="btnCopy(card?.keyb)"><div class="input-group-prepend"><span class="input-group-text justify-content-center">keyB</span></div><textarea class="form-control" rows="16" :value="card?.keyb" readonly></textarea></div></div></div></div></div><div class="form-group" style="min-width:250px"><label>EML (HEX)</label><textarea class="form-control form-control-sm" rows="65" v-model="h.eml"></textarea></div></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/proxmark3.js/proxmark3.min.js" crossorigin="anonymous"></script><script>const Packet=window.Proxmark3["Packet"];Packet.prototype.getUnixStr=function(t){t=this.getUint32(t);return t?dayjs.unix(t).format("YYYY-MM-DD HH:mm:ss"):"無資料"},Packet.prototype.getDosDateStr=function(t){t=this.getUint16(t);return t?dayjs(1980+(t>>9)+`-${t>>5&15}-`+(31&t)).format("YYYY-MM-DD"):"無資料"},window.ipass={xferGroups:_.fromPairs([["00","無轉乘"],["06","台鐵"],["0B","高雄捷運"],["17","高雄輕軌"],["0C","高雄市區公車"],["FE","高雄客運1"],["B3","高雄客運2"],["B4","高雄客運3"],["B2","渡輪"],["A2","高雄 YouBike"]])};class Ipass{constructor(t){if(!(t&&t instanceof Packet&&1024===t.byteLength))throw new TypeError("invalid pack");this.pack=t,this.credit=this.getTxn(160),this.deducts=_.chain([16,17,18,20,21,22]).map(t=>this.getTxn(t<<4)).sortBy(["time"]).value()}static fromEml(t){t=Packet.fromHex(t.replace(/-/g,"0"));if(1024!==t.byteLength)throw new TypeError("錯誤的 eml");return new Ipass(t)}makeTxnWithXfer({cost:t=0,time:e,group:r=0}){const a=this.pack.slice(),s={},n={};var i=t=>a.subarray(t,t+16),h=(n.tsqn=i(192),s.tsqn=n.tsqn.slice(),t=>{let e=s.tsqn[1]<<8|a[t];return e>s.tsqn.getUint16(0)&&(e-=256),4294967296*e+a.getUint32(t+1)});s.txn=i(_.maxBy([160,256,272,288,320,336,352],h)),n.txn=i(_.minBy([256,272,288,320,336,352],h)),a.setInt32(128,a.getInt32(128)-t);for(const c of[136,144,152])a.setInt32(c,a.getInt32(128));for(const o of[132,148])a.setInt32(o,~a.getInt32(128));return n.tsqn.setUint16(0,s.tsqn.getUint16(0)+1),n.tsqn[2]=(i=e,h=s.txn.getUint32(1),_.floor(i/86400)===_.floor(h/86400)?s.tsqn[2]+1:0),n.tsqn.setUint32(3,e),n.tsqn[8]=s.tsqn[7],n.tsqn[7]=r,n.tsqn.set(Packet.fromHex("20AD012EBD0100"),9),n.txn[0]=n.tsqn[0],n.txn.setUint32(1,e),n.txn[5]=32,n.txn.setUint16(6,t),n.txn.set(a.subarray(128,130),8),n.txn.set(Packet.fromHex("AD012EBD0100"),10),new Ipass(a)}getTxn(t){const e=this.pack;return{ctsn:"0x"+e.subarray(t,t+1).hex,time:e.getUnixStr(t+1),type:"0x"+this.pack.subarray(t+5,t+6).hex,amount:e.getInt16(t+6),ev:e.getInt16(t+8),system:"0x"+this.pack.subarray(t+10,t+11).hex,spid:"0x"+this.pack.subarray(t+11,t+12).hex,device:"0x"+this.pack.subarray(t+12,t+16).hex}}get keya(){const e=this.pack;return _.uniq(_.times(16,t=>e.subarray(48+(t<<6),54+(t<<6)).hex)).join("\n")}get keyb(){const e=this.pack;return _.uniq(_.times(16,t=>e.subarray(58+(t<<6),64+(t<<6)).hex)).join("\n")}get eml(){const e=this.pack;return _.times(64,t=>e.subarray(t<<4,t+1<<4).hex).join("\n")}get area(){return"0x"+this.pack.subarray(451,452).hex}get autoload(){return"0x"+this.pack.subarray(80,81).hex}get autoloadCnt(){return"0x"+this.pack.subarray(89,90).hex}get autoloadDate(){return this.pack.getDosDateStr(87)}get autoloadQuota(){return this.pack.getUint16(83)}get autoloadUnit(){return this.pack.getUint16(81)}get bank(){return"0x"+this.pack.subarray(411,412).hex}get busCardType(){return"0x"+this.pack.subarray(512,513).hex}get csn(){return"0x"+this.pack.subarray(0,16).hex}get ctsn(){return"0x"+this.pack.subarray(192,194).rhex}get enterpriseId(){return"0x"+this.pack.subarray(412,414).hex}get ev(){return this.pack.getUint32(128)}get exp(){return this.pack.getUnixStr(73)}get isRegister(){return"0x"+this.pack.subarray(94,95).hex}get issued(){return this.pack.getUnixStr(69)}get issuer(){return"0x"+this.pack.subarray(64,65).hex}get type(){return"0x"+this.pack.subarray(448,449).hex}get profileExp(){return this.pack.getUnixStr(385)}get profileType(){return"0x"+this.pack.subarray(384,385).hex}get quotaTxn(){return this.pack.getUint16(85)}get registerId(){return"0x"+this.pack.subarray(414,416).hex}get status(){return"0x"+this.pack.subarray(78,79).hex}get travelDay(){return"0x"+this.pack.subarray(416,417).hex}get travelExpire(){return this.pack.getUnixStr(417)}get uid(){return this.pack.subarray(0,4).hex}get version(){return"0x"+this.pack.subarray(77,78).hex}get welfareDate(){return this.pack.getDosDateStr(519)}get welfareIdentity(){return"0x"+this.pack.subarray(514,515).hex}get welfareLimit(){return this.pack.getUint16(523)}get welfareProvider(){return"0x"+this.pack.subarray(513,514).hex}get welfareUsed(){return this.pack.getUint16(521)}get xfer(){var t=this.pack.getUint8(194);return{txnIdx:t,time:this.pack.getUnixStr(195),after:"0x"+this.pack.subarray(199,200).hex,before:"0x"+this.pack.subarray(200,201).hex,type:"0x"+this.pack.subarray(201,202).hex,system:"0x"+this.pack.subarray(202,203).hex,location:"0x"+this.pack.subarray(203,204).hex,device:"0x"+this.pack.subarray(204,208).hex,txn:t?this.getTxn([null,16,17,18,20,21,22][t]<<4):null}}}window.vm=new Vue({el:"#app",data:{ready:!1,h:{eml:"",xferCost:0,xferGroup:"00",xferTime:""}},async mounted(){try{var t=JSON5.parse(localStorage.getItem(location.pathname));t&&this.$set(this,"h",{...this.h,...t})}catch(t){}this.$watch("h",()=>{localStorage.setItem(location.pathname,JSON5.stringify(this.h))},{deep:!0}),await this.init()},computed:{card(){try{return this.ready?Ipass.fromEml(this.h.eml):void 0}catch(t){console.error(t)}}},methods:{async init(){try{this.ready=!0}catch(t){console.error(t),Swal.fire({icon:"error",title:"發生錯誤",text:t.message})}},async btnCopy(t,e=null){e=e||document.body;const r=document.createElement("textarea");r.value=t,e.appendChild(r),r.select(),r.setSelectionRange(0,1e6),document.execCommand("copy"),e.removeChild(r),await Swal.fire({icon:"success",title:"複製成功"})},async btnMakeTxnWithXfer(){try{if(!/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(this.h.xferTime))throw new TypeError("invalid time");if(this.h.xferCost<0)throw new TypeError("invalid cost");var t=await this.card.makeTxnWithXfer({cost:this.h.xferCost??0,time:dayjs(this.h.xferTime).unix(),group:_.parseInt(this.h.xferGroup,16)});await this.btnCopy(t.eml)}catch(t){console.error(t),await Swal.fire({icon:"error",title:"發生錯誤",text:t.message})}},btnSetXferTimeBeforeNow(t){this.$set(this.h,"xferTime",dayjs().subtract(t,"minute").format("YYYY-MM-DD HH:mm:ss"))}}});</script></body></html>