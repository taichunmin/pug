<!doctype html><html><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>微程式 LINE 名片</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-39556213-3");</script><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><meta content="https://taichunmin.idv.tw/pug/microprogram-businesscard.html" property="og:url"><meta content="微程式 LINE 名片" property="og:title"><meta content="請開啟本連結並按一下「選擇分享對象」來透過 LINE 分享名片" property="og:description"><meta content="https://i.imgur.com/5zNfhhe.png" property="og:image"><meta content="600" property="og:image:width"><meta content="315" property="og:image:height"><meta content="website" property="og:type"><meta content="zh_TW" property="og:locale"><meta content="筆記國度" property="og:site_name"><meta content="2133031763635285" property="fb:app_id"><style>[v-cloak]{display:none}textarea{height:150px}</style></head><body><div class="container my-4 text-monospace" id="app" v-cloak><h1 class="text-center my-3">微程式 LINE 名片</h1><div id="share" v-if="page === 'share'"><p>請按一下「選擇分享對象」來透過 LINE 分享「{{ vcard.中文姓名 }}」的名片吧！</p><button @click="btnShare" class="my-2 btn btn-block btn-lg btn-success" type="button">選擇分享對象</button><button @click="btnSend" class="my-2 btn btn-block btn-lg btn-info" type="button">傳送到目前聊天視窗</button></div><div id="form" v-if="page === 'form'" method="get" target="_blank"><div class="my-2 form-group"><label for="i-ext">分機</label><input class="form-control form-control-sm" id="i-ext" name="ext" v-model="i.ext"><small class="form-text text-muted" id="help-label">請填寫數位版名片的 CSV 資料中存在的 uuid。</small></div><div class="my-2 form-group"><label for="i-result">結果</label><textarea :value="shortcut" class="form-control form-control-sm" id="brwoser" readonly></textarea><small class="form-text text-muted" id="help-label">請複製此網址，然後在 LINE 中傳給使用者。</small></div><button @click="btnCopy(shortcut)" class="my-2 btn btn-success mr-2">複製</button><a :href="shortcut" class="my-2 btn mr-2 btn-primary" target="_blank">測試</a></div><div id="loading" v-if="page === 'loading'"><div class="text-center py-3">載入名片資料中，請稍候…</div></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/joi@17/dist/joi-browser.min.js" crossorigin="anonymous"></script><script src="https://static.line-scdn.net/liff/edge/2/sdk.js" crossorigin="anonymous"></script><script>const errorToJson=(()=>{const e=["address","code","data","dest","errno","info","message","name","originalError.response.data","path","port","reason","response.data","response.headers","response.status","stack","status","statusCode","statusMessage","syscall"];return r=>_.transform(e,(e,t)=>{_.hasIn(r,t)&&_.set(e,t,_.get(r,t))},{})})(),TPL_PREFIX="https://gist.githubusercontent.com/taichunmin/4c3931a5ef5168b8ddab341c770b151e/raw/",CSV_URL="https://gist.githubusercontent.com/taichunmin/4c3931a5ef5168b8ddab341c770b151e/raw/microprogram.csv",LIFF_ID="1654437282-n2QwW3Nm",vm=new Vue({el:"#app",data:{error:null,page:"loading",params:{},vcard:null,renders:{},i:{ext:100}},async mounted(){try{if(await liff.init({liffId:LIFF_ID}),this.param("liff.state"))return;if(this.params.ext=this.param("ext"),!this.params.ext)return void(this.page="form");if(!liff.isLoggedIn())return liff.login({redirectUri:location.href});await Promise.all([this.getTpl("default",TPL_PREFIX+"microprogram-default.txt"),this.getTpl("no-mobile",TPL_PREFIX+"microprogram-no-mobile.txt"),this.getVcard()]),this.page="share"}catch(e){this.handleError(e)}},computed:{shortcut(){return this.i.ext?`https://liff.line.me/${LIFF_ID}/?`+Qs.stringify(this.i):""}},methods:{param(e,t){e=new URL(location).searchParams.get(e);return _.isNil(e)?t:e},handleError(e){this.$set(this,"error",errorToJson(e)),console.error(e),Swal.fire({icon:"error",title:"發生錯誤",text:e.message})},canSendMessages(){if(!liff.isInClient())return!1;var e=_.get(liff.getContext(),"type");return!!_.includes(["utou","room","group","square_chat"],e)},getRenderedMsgs(){let e="default",t=("0000000000"===this.vcard.手機號碼&&(e="no-mobile"),JSON5.parse(this.renders[e]({vcard:this.vcard,_:_,Qs:Qs})));return _.includes(["bubble","carousel"],_.get(t,"type"))&&(t={type:"flex",altText:"請在手機上查看數位版名片。",contents:t}),_.isArray(t)||(t=[t]),console.log("msg =",JSON.stringify(t)),t},async getTpl(e,t){try{var r=_.template(_.get(await axios.get(t,{params:{cachebust:+new Date},transformResponse:[]}),"data"));if(!_.isFunction(r))throw new Error("");this.renders[e]=r}catch(e){throw e.message=e.message?"名片樣板獲取失敗: "+e.message:"名片樣板獲取失敗",this.render=null,e}},async getCsv(e,t=3e4){e=_.trim(_.get(await axios.get(e,{params:{cachebust:_.floor(Date.now()/t)}}),"data"));return _.get(Papa.parse(e,{encoding:"utf8",header:!0}),"data",[])},async getVcard(){try{if(this.vcard=_.find(await this.getCsv(CSV_URL),{uuid:""+this.params.ext}),!this.vcard)throw new Error("找不到指定的名片資料")}catch(e){throw e.message=e.message?"名片資料獲取失敗: "+e.message:"名片資料獲取失敗",this.vcard=null,e}},async btnShare(){try{if(!liff.isApiAvailable("shareTargetPicker"))throw new Error("不支援 shareTargetPicker，請嘗試更新應用程式版本。");await liff.shareTargetPicker(this.getRenderedMsgs()),Swal.fire({icon:"success",title:"名片已分享"})}catch(e){this.handleError(e)}},async btnSend(){try{if(!this.canSendMessages())throw new Error("沒有傳訊訊息的權限，請在聊天視窗內開啟。");await liff.sendMessages(this.getRenderedMsgs()),Swal.fire({icon:"success",title:"名片已傳送"})}catch(e){this.handleError(e)}},async btnCopy(e,t=null){t=t||document.body;const r=document.createElement("textarea");r.value=e,t.appendChild(r),r.select(),r.setSelectionRange(0,1e6),document.execCommand("copy"),t.removeChild(r),await Swal.fire({icon:"success",title:"複製成功"})}}});</script></body></html>