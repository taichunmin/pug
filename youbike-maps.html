<!doctype html><html><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>YouBike 站點地圖</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-39556213-3");</script><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><meta content="YouBike 站點地圖 (1.0 + 2.0)" name="description"><meta content="YouBike,Maps,地圖,微笑單車" name="keywords"><meta content="2133031763635285" property="fb:app_id"><meta content="YouBike 站點地圖 (1.0 + 2.0)" property="og:description"><meta content="315" property="og:image:height"><meta content="600" property="og:image:width"><meta content="https://i.imgur.com/Av4FEFk.png" property="og:image"><meta content="zh_TW" property="og:locale"><meta content="筆記國度" property="og:site_name"><meta content="YouBike 站點地圖" property="og:title"><meta content="website" property="og:type"><meta content="https://taichunmin.idv.tw/pug/youbike-maps.html" property="og:url"><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/leaflet@1/dist/leaflet.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1/dist/MarkerCluster.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1/dist/MarkerCluster.Default.css" rel="stylesheet"><style>[v-cloak]{display:none}#app,#map,body,html{height:100%;width:100vw}#app{position:relative}#ubike-visible{background-color:#fff;padding:.3rem .5rem;position:absolute;right:10px;top:10px}.unselectable{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.leaflet-popup-content{font-size:14px}.leaflet-popup-content h6{font-size:18px;margin-bottom:1rem}.leaflet-popup-content .table-station th{white-space:nowrap}.leaflet-popup-content .table-station td{text-align:right}</style></head><body><div id="app" v-cloak><div id="ubike-visible" class="leaflet-bar leaflet-control text-monospace unselectable" v-if="_.keys(visible).length"><div class="custom-control custom-switch" :key="k" v-for="(v, k) in visible"><input :id="`switch-ubike${k}`" class="custom-control-input" type="checkbox" v-model="visible[k]"><label :for="`switch-ubike${k}`" class="custom-control-label">YouBike {{ k }}.0</label></div></div><div id="map"></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/joi@17/dist/joi-browser.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/leaflet@1/dist/leaflet.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1/dist/leaflet.markercluster.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/moment@2/moment.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/moment@2/locale/zh-tw.min.js" crossorigin="anonymous"></script><script>const httpBuildQuery=(t,e={})=>Qs.stringify(t,{arrayFormat:"brackets",...e}),verifyStationRealtime=(()=>{const e=joi.object({id:joi.number().integer().min(1).empty("").required(),name:joi.string().empty("").required(),type:joi.number().integer().valid(1,2).empty("").required(),space:joi.number().integer().min(0).default(0).empty(""),full:joi.number().integer().min(0).default(0).empty(""),empty:joi.number().integer().min(0).default(0).empty(""),city:joi.string().empty("").optional(),area:joi.string().empty("").optional(),lat:joi.number().min(21).max(28).empty("0").required(),lng:joi.number().min(117).max(123).empty("0").required(),place_id:joi.string().empty("").optional(),address:joi.string().empty("").optional(),is_open:joi.number().integer().min(0).default(0).empty(""),updated_at:joi.date().timestamp("unix").required()}),i={abortEarly:!1,stripUnknown:!0};return t=>e.validateAsync(t,i)})(),stationToIcon=(()=>{const t=L.Icon.extend({options:{iconAnchor:[13,37],iconSize:[26,40],popupAnchor:[0,-39]}}),e={1:{gray:new t({iconUrl:"https://i.imgur.com/Ds0qFq3.png"}),green:new t({iconUrl:"https://i.imgur.com/ReY0lVJ.png"}),red:new t({iconUrl:"https://i.imgur.com/4eoBKk4.png"}),yellow:new t({iconUrl:"https://i.imgur.com/cuIV9SU.png"})},2:{gray:new t({iconUrl:"https://i.imgur.com/6Le0sE3.png"}),green:new t({iconUrl:"https://i.imgur.com/5aYRtXr.png"}),red:new t({iconUrl:"https://i.imgur.com/dZtjHXS.png"}),yellow:new t({iconUrl:"https://i.imgur.com/yjIc9m9.png"})}};return t=>t.is_open?0===t.space?e[t.type].red:0===t.full?e[t.type].yellow:e[t.type].green:e[t.type].gray})(),stationToPopup=t=>`<h6 class="mb-2"><strong>${t.name}</strong></h6>
<table class="table table-sm table-borderless table-station text-monospace">
  <tr><th>車輛</th><td><i class="fa fa-fw fa-bicycle"></i> ${t.full} / ${t.full+t.empty} ${t.is_open?"":" (暫停營運)"}</td></tr>
  <tr><th>縣市</th><td>${t.city}${t.area}</td></tr>
  <tr><th>位置</th><td>${t.address}</td></tr>
  <tr><th>更新</th><td>${moment(t.updated_at).format("YYYY-MM-DD HH:mm:ss")}</td></tr>
</table>
<a class="btn btn-dark btn-sm btn-block text-white" href="${(t=>{const e={api:1,destination:t.lat+","+t.lng,travelmode:"walking"};return _.isString(t.place_id)&&t.place_id&&(e.destination_place_id=t.place_id),"https://www.google.com/maps/dir/?"+httpBuildQuery(e)})(t)}" role="button" target="_blank">
  <i class="fa fa-fw fa-map-o"></i>
  導航
</a>`,[DEFAULT_LAT,DEFAULT_LNG,DEFAULT_ZOOM]=[25.040857,121.567904,15];let map;const vm=new Vue({el:"#app",data:{src:"https://gcs-youbike2-linebot.microprogram.tw/latest-data/youbike-station.csv",visible:{}},async mounted(){moment.locale("zh-tw"),this.initMap(),this.initStations()},methods:{async getStations(){var t=await this.getCsv(this.src);return _.filter(await Promise.all(_.map(t,async t=>{try{return t=await verifyStationRealtime(t),_.includes([1,2],t.is_open)?t:null}catch(t){return null}})))},async initStations(){const a=this.parseJsonOrDefault(localStorage.getItem("youbike-maps-visible"),{});var t=window.types=_.groupBy(await this.getStations(),"type");_.each(t,(t,e)=>{const i=L.markerClusterGroup({chunkedLoading:!0,disableClusteringAtZoom:16,spiderfyOnMaxZoom:!1}).addLayers(_.map(t,t=>L.marker([t.lat,t.lng],{icon:stationToIcon(t)}).bindPopup(stationToPopup(t),{minWidth:200})));this.$set(this.visible,e,!1),this.$watch("visible."+e,(t,e)=>{map.hasLayer(i)^t&&(map[t?"addLayer":"removeLayer"](i),localStorage.setItem("youbike-maps-visible",JSON.stringify(this.visible)))}),_.get(a,e,!0)&&this.$set(this.visible,e,!0)})},async initMap(){var t=L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attribution">CARTO</a>'}),t=(map=L.map("map",{center:[DEFAULT_LAT,DEFAULT_LNG],zoom:DEFAULT_ZOOM,layers:[t]}),await new Promise(e=>{map.locate({setView:!0}).on("locationfound",t=>{e(t.latlng)}).on("locationerror",t=>{e(L.latLng(DEFAULT_LAT,DEFAULT_LNG))})}));map.setZoom(DEFAULT_ZOOM),L.circle(t,{stroke:!1,fillColor:"#00beff",fillOpacity:.2,radius:300}).addTo(map),L.circle(t,{stroke:!1,fillColor:"#00beff",fillOpacity:.1,radius:1e3}).addTo(map),L.marker(t,{icon:L.icon({iconAnchor:[10,36],iconSize:[20,38],iconUrl:"https://i.imgur.com/vXd4IW8.png",popupAnchor:[0,-38]})}).addTo(map)},async getCsv(t,e=3e4){t=_.trim(_.get(await axios.get(t,{params:{cachebust:_.floor(Date.now()/e)}}),"data"));return _.get(Papa.parse(t,{encoding:"utf8",header:!0}),"data",[])},parseJsonOrDefault(t,e){try{return JSON.parse(t)}catch(t){return e}}}});</script></body></html>