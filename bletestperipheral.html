<!doctype html><html><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>ble-test-peripheral</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-39556213-3");</script><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><meta content="2133031763635285" property="fb:app_id"><meta content="ble-test-peripheral" property="og:description"><meta content="zh_TW" property="og:locale"><meta content="筆記國度" property="og:site_name"><meta content="ble-test-peripheral" property="og:title"><meta content="website" property="og:type"><meta content="https://taichunmin.idv.tw/pug/bletestperipheral.html" property="og:url"><style>[v-cloak]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,body,h1,h2,h3,h4,h5,h6{font-family:"Noto Sans TC",sans-serif}</style></head><body><div class="container-fluid my-3" id="app" style="max-width:760px" v-cloak><h3 class="mb-3 text-center"><a href="https://play.google.com/store/apps/details?id=io.github.webbluetoothcg.bletestperipheral" target="_blank">ble-test-peripheral</a></h3><div class="card mb-4"><h5 class="bg-primary card-header text-white">Battery Service</h5><div class="card-body"><div class="mb-3 input-group"><div class="input-group-prepend"><span class="input-group-text">Battery Level</span></div><input :value="battery.level" class="form-control text-right" readonly></div><button @click="batteryRequestDevice" class="btn btn-block btn-outline-primary" type="button" v-if="!battery.device"><span class="fa fa-fw fa-bluetooth"></span> 搜尋裝置</button><button @click="batteryDisconnect" class="btn btn-block btn-outline-danger" type="button" v-else><span class="fa fa-fw fa-ban"></span> 中斷連線</button></div></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script>window.errToPlainObj=(()=>{const t=["address","code","data","dest","errno","info","message","name","path","port","reason","response.data","response.headers","response.status","stack","status","statusCode","statusMessage","syscall"];return e=>_.pick(e,t)})(),window.vm=new Vue({el:"#app",data:{battery:{device:null,level:null}},methods:{async batteryRequestDevice(){try{if(!await this.getBluetoothAvailability())throw new Error("您的裝置不支援藍芽功能");this.showLoading("請稍候","搜尋裝置中…");const e=this.battery;if(e.device=await navigator.bluetooth.requestDevice({filters:[{services:["battery_service"]}]}),!e.device)throw new Error("未選擇裝置");e.device.addEventListener("gattserverdisconnected",this.batteryOnDisconnect);const t=await e.device.gatt.connect(),a=await t.getPrimaryService("battery_service"),i=await a.getCharacteristic("battery_level"),r=await i.readValue();e.level=r.getUint8(0),i.addEventListener("characteristicvaluechanged",this.batteryOnLevelNotify),i.startNotifications(),Swal.close()}catch(e){console.error(window.errToPlainObj(e)),await Swal.fire({icon:"error",title:"發生錯誤",text:e.message})}},async batteryOnLevelNotify(e){const t=this.battery,a=_.get(e,"target.value");t.level=a.getUint8(0),console.log("batteryOnLevelNotify = "+t.level)},async batteryDisconnect(){try{const e=this.battery;_.get(e,"device.gatt.connected")&&e.device.gatt.disconnect()}catch(e){console.error(window.errToPlainObj(e)),await Swal.fire({icon:"error",title:"發生錯誤",text:e.message})}},async batteryOnDisconnect(){const e=this.battery;e.device=null},async getBluetoothAvailability(){return _.invoke(navigator,"bluetooth.getAvailability")},showLoading(e,t){Swal.fire({title:e,text:t,allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>{Swal.showLoading()}})}}});</script></body></html>