<!doctype html><html><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>NFC M1 EML Diff Tools</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-39556213-3");</script><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><style>[v-cloak]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,body,h1,h2,h3,h4,h5,h6{font-family:"Noto Sans TC",sans-serif}.eml-table{min-width:323px}.eml-table table{width:321px}.eml-table td{font-size:12px;height:20px}.eml-table .byte-keya,.eml-table .byte-keyb{color:#17a2b8}.eml-table .byte-acl{color:#ffc107}.eml-table .byte-ne{background-color:#d8d2e9}.eml-table .byte-current{border-color:#dc3545!important}.eml-table .byte-left{border-right-color:#dc3545!important}.eml-table .byte-up{border-bottom-color:#dc3545!important}</style></head><body><div class="container-fluid my-3 text-monospace" id="app" v-cloak><h2 class="text-center mb-3">NFC M1 EML Diff Tools</h2><div class="d-flex mx-n1 flex-row mt-3"><div class="card eml-table mx-1" v-for="eml, emlIdx of emls"><div class="d-flex align-items-center card-header pl-3 pr-2"><i class="fa fa-id-card-o mr-2"></i><div class="mr-auto">卡號 {{ eml.uid }}</div><div class="dropdown"><button class="btn btn-sm my-n2" type="button" data-toggle="dropdown"><i class="fa fa-chevron-down"></i></button><div class="dropdown-menu dropdown-menu-right"><button class="dropdown-item" type="button" @click="btnEditEml(emlIdx)">編輯</button></div></div></div><table class="table table-bordered mb-0 table-sm text-center"><tr v-for="i of _.times(64)"><template v-for="j of _.range(i * 16, i * 16 + 16)"><td :class="byteClass(j)" @click="h.pos = j" class="align-middle p-0">{{ eml.buf.subarray(j, j + 1).hex }}</td></template></tr></table></div><div class="flex-fill mx-1 table-responsive"><div class="custom-control custom-switch my-2"><input class="custom-control-input" id="h-littleEndian" type="checkbox" v-model="h.littleEndian"><label class="custom-control-label" for="h-littleEndian">Little Endian</label></div><table class="table table-bordered table-striped" id="eml-inspect"><tr><th scope="row">pos</th><td colspan="2">P<span class="text-info">{{ h.pos }}</span>, B<span class="text-info">{{ h.pos >> 4 }}</span>#<span class="text-info">{{ h.pos & 0xF }}</span>, S<span class="text-info">{{ h.pos >> 6 }}</span>B<span class="text-info">{{ (h.pos >> 4) & 0x3 }}</span>#<span class="text-info">{{ h.pos & 0xF }}</span></td></tr><tr><th scope="row">getUint8</th><td v-for="eml of emls" v-if="eml">{{ eml.buf.getUint8(h.pos, h.littleEndian) }}</td></tr><tr><th scope="row">getInt8</th><td v-for="eml of emls" v-if="eml">{{ eml.buf.getInt8(h.pos, h.littleEndian) }}</td></tr><tr v-if="h.pos + 1 < 1024"><th scope="row">getUint16</th><td v-for="eml of emls" v-if="eml">{{ eml.buf.getUint16(h.pos, h.littleEndian) }}</td></tr><tr v-if="h.pos + 1 < 1024"><th scope="row">getInt16</th><td v-for="eml of emls" v-if="eml">{{ eml.buf.getInt16(h.pos, h.littleEndian) }}</td></tr><tr v-if="h.pos + 2 < 1024"><th scope="row">getUint24</th><td v-for="eml of emls" v-if="eml">{{ eml.buf.getUint24(h.pos, h.littleEndian) }}</td></tr><tr v-if="h.pos + 2 < 1024"><th scope="row">getInt24</th><td v-for="eml of emls" v-if="eml">{{ eml.buf.getInt24(h.pos, h.littleEndian) }}</td></tr><tr v-if="h.pos + 3 < 1024"><th scope="row">getUint32</th><td v-for="eml of emls" v-if="eml">{{ eml.buf.getUint32(h.pos, h.littleEndian) }}</td></tr><tr v-if="h.pos + 3 < 1024"><th scope="row">getInt32</th><td v-for="eml of emls" v-if="eml">{{ eml.buf.getInt32(h.pos, h.littleEndian) }}</td></tr><tr v-if="h.pos + 1 < 1024"><th scope="row">getDosDateStr</th><td v-for="eml of emls" v-if="eml">{{ eml.buf.getDosDateStr(h.pos, h.littleEndian) }}</td></tr><tr v-if="h.pos + 3 < 1024"><th scope="row">getUnixStr<br>-08:00</th><td v-for="eml of emls" v-if="eml">{{ eml.buf.getUnixStr(h.pos, -28800, h.littleEndian) }}</td></tr><tr v-if="h.pos + 3 < 1024"><th scope="row">getUnixStr<br>+00:00</th><td v-for="eml of emls" v-if="eml">{{ eml.buf.getUnixStr(h.pos, 0, h.littleEndian) }}</td></tr></table></div></div><div class="fade modal" id="modal-exportimport" data-backdrop="static" data-keyboard="false" ref="modalExportimport" tabindex="-1"><div class="align-items-stretch modal-dialog modal-dialog-centered modal-xl"><div class="modal-content"><div class="d-flex flex-column modal-body"><div class="d-flex flex-fill mx-n1"><div class="d-flex flex-column flex-fill form-group mx-1 my-0" v-for="i of _.times(2)"><label @click="btnCopy(exportimport.emls[i], $refs['modalExportimport'])">{{ '左右'[i] }}方 (點此可複製)</label><textarea class="flex-fill form-control form-control-sm" v-model="exportimport.emls[i]"></textarea></div></div><small class="form-text text-muted">請複製或貼上 EML 並點一下「匯入」按鈕。</small></div><div class="modal-footer"><button class="btn btn-secondary" type="button" @click="_.invoke(exportimport, 'resolve', 0)">關閉</button><button class="btn btn-primary" type="button" @click="_.invoke(exportimport, 'resolve', 1)">匯入</button></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/proxmark3.js/proxmark3.min.js" crossorigin="anonymous"></script><script>const Packet=window.Proxmark3["Packet"];Packet.prototype.getUnixStr=function(t,e=0,s=!0){return dayjs.unix(this.getUint32(t,s)+e).format("YYYY-MM-DD HH:mm:ss")},Packet.prototype.getDosDateStr=function(t,e=!0){t=this.getUint16(t,e);return t?dayjs(1980+(t>>9)+`-${t>>5&15}-`+(31&t)).format("YYYY-MM-DD"):"無資料"};class M1{constructor(t){if(!(t&&t instanceof Packet&&1024===t.byteLength))throw new TypeError("invalid buf");this.buf=t}static fromEml(t){t=Packet.fromHex(t.replace(/-/g,"0"));if(1024!==t.byteLength)throw new TypeError("錯誤的 eml");return new M1(t)}get keya(){const e=this.buf;return _.uniq(_.times(16,t=>e.subarray(48+(t<<6),54+(t<<6)).hex)).join("\n")}get keyb(){const e=this.buf;return _.uniq(_.times(16,t=>e.subarray(58+(t<<6),64+(t<<6)).hex)).join("\n")}get eml(){const e=this.buf;return _.times(64,t=>e.subarray(t<<4,t+1<<4).hex).join("\n")}get uid(){return this.buf.subarray(0,4).hex}}window.vm=new Vue({el:"#app",data:{h:{emls:["",""],littleEndian:!0,pos:0},exportimport:{emls:["",""],resolver:null}},async mounted(){try{var t=JSON5.parse(localStorage.getItem(location.pathname));t&&this.$set(this,"h",{...this.h,...t})}catch(t){}this.$watch("h",()=>{localStorage.setItem(location.pathname,JSON5.stringify(this.h))},{deep:!0})},computed:{emls(){const s=[];for(let e=0;e<2;e++)try{s[e]=M1.fromEml(this.h.emls[e])}catch(t){s[e]=new M1(new Packet(1024))}return s}},methods:{async btnEditEml(t){const e=this.exportimport;var s=new Promise(t=>{this.$set(e,"resolve",t)}),s=(this.$set(e,"emls",[...this.h.emls]),this.jqModal("modalExportimport","show"),await s);this.$set(e,"resolve",null),this.jqModal("modalExportimport","hide"),s&&this.$set(this.h,"emls",[...e.emls])},async btnCopy(t,e=null){e=e||document.body;const s=document.createElement("textarea");s.value=t,e.appendChild(s),s.select(),s.setSelectionRange(0,1e6),document.execCommand("copy"),e.removeChild(s),await Swal.fire({icon:"success",title:"複製成功"})},byteClass(t){const e={block:t>>4,blockPos:15&t,sector:t>>6,sectorBlock:t>>4&3,class:[]};return t===this.h.pos?e.class.push("byte-current"):t+1===this.h.pos&&e.blockPos<15?e.class.push("byte-left"):t+16===this.h.pos&&e.class.push("byte-up"),3===e.sectorBlock&&(e.blockPos<6?e.class.push("byte-keya"):e.blockPos<10?e.class.push("byte-acl"):e.class.push("byte-keyb")),this.emls&&(t=[this.emls[0].buf.getUint8(t),this.emls[1].buf.getUint8(t)])[0]!==t[1]&&e.class.push("byte-ne"),e.class.join(" ")},jqModal(t,e){window.jQuery(this.$refs[t]).modal(e)}}});</script></body></html>