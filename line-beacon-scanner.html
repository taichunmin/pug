<!doctype html><html><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>掃描附近的 LINE Beacon</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-39556213-3");</script><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><style>[v-cloak]{display:none}.beacon{font-size:.75rem}.beacon th{width:1px}</style></head><body><div class="container text-monospace" id="app" v-cloak><h3 class="my-3 text-center">掃描附近的 LINE Beacon</h3><div class="my-3 mx-n2 row"><div class="col mx-2 px-0"><button @click="btnClear" class="btn btn-block btn-danger" type="button">清空資料</button></div><div class="col mx-2 px-0"><button @click="btnToggleScan" class="btn btn-block btn-success" type="button" v-if="!scanning">開始掃描</button><button @click="btnToggleScan" class="btn btn-block btn-warning" type="button" v-else>停止掃描</button></div></div><template v-if="!_.keys(beacons).length"><div class="input-group input-group-sm"><input class="form-control" readonly type="url" value="chrome://flags/#enable-experimental-web-platform-features"><div class="input-group-append"><button @click="btnCopy('chrome://flags/#enable-experimental-web-platform-features')" class="btn btn-outline-success" type="button">複製網址</button></div></div><small class="text-muted">如果無法掃描，請嘗試使用 macOS 和 Android 系統的 Google Chrome（版本大於 79）開啟，並且前往上方網址啟用 Experimental Web Platform features 功能。</small></template><div class="row"><div class="col-12 col-md-4 col-sm-6 my-2" :key="beacon.id" v-for="beacon of beacons"><table class="beacon mb-0 table table-bordered table-dark table-sm text-right"><tr v-for="k in ['id', 'name', 'rssi', 'hwid', 'dm', 'auth', 'maskedTimestamp', 'batteryLevel', 'mbid', 'scannedAt']"><th>{{ k }}</th><td>{{ _.get(beacon, k, '無資料') }}</td></tr></table></div></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/moment@2/moment.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/moment@2/locale/zh-tw.min.js" crossorigin="anonymous"></script><script src="https://taichunmin.idv.tw/proxmark3.js/proxmark3.min.js" crossorigin="anonymous"></script><script>const Packet=window.Proxmark3["Packet"],bluetooth=_.get(navigator,"bluetooth"),UUID_LINE="0000fe6f-0000-1000-8000-00805f9b34fb",vm=new Vue({el:"#app",data:{beacons:{},scan:null,scanning:!1},mounted(){moment.locale("zh-tw"),bluetooth.addEventListener("advertisementreceived",e=>{this.onAdvertisementReceived(e)}),window.setInterval(()=>{this.updateScanning()},1e3)},methods:{async getBluetoothAvailability(){return!0===await _.invoke(navigator,"bluetooth.getAvailability")},async btnToggleScan(){try{if(this.updateScanning(),this.scanning)this.scan.stop(),this.scan=null;else{if(!await this.getBluetoothAvailability())throw new Error("您的裝置不支援藍芽功能");this.scan=await bluetooth.requestLEScan({filters:[{services:[UUID_LINE]}]})}}catch(e){Swal.fire({icon:"error",text:e.message,title:"藍芽掃描切換失敗"})}},async onAdvertisementReceived(e){const t=Packet.fromView(e.serviceData.get(UUID_LINE));t.byteLength<6||(e={id:_.trim(_.get(e,"device.id"),"="),name:_.get(e,"device.name"),rssi:_.get(e,"rssi"),txPower:_.get(e,"txPower"),uuids:_.get(e,"uuids"),frameType:t.subarray(0,1).hex,hwid:t.subarray(1,6).hex,dm:t.subarray(7).hex,scannedAt:moment().format("HH:mm:ss"),..._.includes([14,19],t.byteLength)?{auth:t.subarray(7,11).hex,maskedTimestamp:`${t.getUint16(11,!1)} (${t.subarray(11,13).hex})`,batteryLevel:t.subarray(13,14).hex}:{},...19!==t.byteLength?{}:{mbid:t.subarray(14,19).hex}},this.$set(this.beacons,e.id,e))},async btnCopy(e,t=null){t=t||document.body;const a=document.createElement("textarea");a.value=e,t.appendChild(a),a.select(),a.setSelectionRange(0,1e6),document.execCommand("copy"),t.removeChild(a),await Swal.fire({icon:"success",title:"複製成功"})},updateScanning(){this.scanning=_.get(this,"scan.active",!1)},btnClear(){this.$set(this,"beacons",{})}}});</script></body></html>