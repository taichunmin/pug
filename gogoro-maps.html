<!doctype html><html><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>GOGORO 電池交換站地圖</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-39556213-3");</script><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><meta content="GOGORO 電池交換站地圖" name="description"><meta content="gogoro,換電站,電池交換站,地圖,電池" name="keywords"><meta content="2133031763635285" property="fb:app_id"><meta content="GOGORO 電池交換站地圖" property="og:description"><meta content="315" property="og:image:height"><meta content="600" property="og:image:width"><meta content="https://i.imgur.com/PkkhiEX.png" property="og:image"><meta content="zh_TW" property="og:locale"><meta content="筆記國度" property="og:site_name"><meta content="GOGORO 電池交換站地圖" property="og:title"><meta content="website" property="og:type"><meta content="https://taichunmin.idv.tw/pug/gogoro-maps.html" property="og:url"><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/leaflet@1/dist/leaflet.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1/dist/MarkerCluster.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1/dist/MarkerCluster.Default.css" rel="stylesheet"><style>[v-cloak]{display:none}#app,#map,body,html{height:100%;width:100vw}#app{position:relative}#ubike-visible{background-color:#fff;padding:.3rem .5rem;position:absolute;right:10px;top:10px}.unselectable{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.leaflet-popup-content{font-size:14px}.leaflet-popup-content h6{font-size:18px;margin-bottom:1rem}.leaflet-popup-content .table-station th{white-space:nowrap}.leaflet-popup-content .table-station td{text-align:right}.leaflet-popup-content .table-time th{background-color:#d6d8db}</style></head><body><div id="app" v-cloak><div id="ubike-visible" class="leaflet-bar leaflet-control text-monospace unselectable" v-if="_.keys(visible).length"><div class="custom-control custom-switch" :key="k" v-for="(v, k) in visible"><input :id="`switch-ubike${k}`" class="custom-control-input" type="checkbox" v-model="visible[k]"><label :for="`switch-ubike${k}`" class="custom-control-label">YouBike {{ k }}.0</label></div></div><div id="map"></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/joi@17/dist/joi-browser.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/leaflet@1/dist/leaflet.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1/dist/leaflet.markercluster.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/moment@2/moment.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/moment@2/locale/zh-tw.min.js" crossorigin="anonymous"></script><script>const httpBuildQuery=(t,a={})=>Qs.stringify(t,{arrayFormat:"brackets",...a}),verifyStationRealtime=(()=>{const a=joi.object({id:joi.string().uuid().required(),name:joi.string().empty("").required(),lat:joi.number().min(21).max(28).empty("0").required(),lng:joi.number().min(117).max(123).empty("0").required(),address:joi.string().replace("台","臺").replace(/(\([^)]+\))/,"<br>$1").empty("").optional(),district:joi.string().empty("").optional(),city:joi.string().replace("台","臺").empty("").optional(),state:joi.number().integer().valid(1).required()});return t=>a.validateAsync(t,{stripUnknown:!0})})(),stationToPopup=t=>`<h6 class="mb-2"><strong>${t.name}</strong></h6>
<table class="table table-sm table-borderless table-station text-monospace">
  <tr><th>縣市</th><td>${t.city} / ${t.district}</td></tr>
  <tr><th>位置</th><td>${t.address}</td></tr>
</table>
<a class="btn btn-dark btn-sm btn-block text-white" href="${(t=>{t={api:1,destination:t.lat+","+t.lng,travelmode:"driving"};return"https://www.google.com/maps/dir/?"+httpBuildQuery(t)})(t)}" role="button" target="_blank">
  <i class="fa fa-fw fa-map-o"></i>
  導航
</a>`,[DEFAULT_LAT,DEFAULT_LNG,DEFAULT_ZOOM]=[25.040857,121.567904,15];let map;const vm=new Vue({el:"#app",data:{src:"https://storage-gogoro.taichunmin.idv.tw/data/gogoro-battery.csv",visible:{}},async mounted(){moment.locale("zh-tw"),this.initMap(),this.initStations()},methods:{async getStations(){return _.filter(await Promise.all(_.map(await this.getCsv(this.src),async t=>{try{var a=""+(t=await verifyStationRealtime(t)).city+t.district;return a===t.address.slice(0,a.length)&&(t.address=t.address.slice(a.length)),t}catch(t){return null}})))},async initMap(){var t;map||(t=L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attribution">CARTO</a>'}),map=L.map("map",{center:[DEFAULT_LAT,DEFAULT_LNG],zoom:DEFAULT_ZOOM,layers:[t]}),t=await new Promise(a=>{map.locate({setView:!0}).on("locationfound",t=>{a(t.latlng)}).on("locationerror",t=>{a(L.latLng(DEFAULT_LAT,DEFAULT_LNG))})}),map.setZoom(DEFAULT_ZOOM),L.circle(t,{stroke:!1,fillColor:"#00beff",fillOpacity:.2,radius:300}).addTo(map),L.circle(t,{stroke:!1,fillColor:"#00beff",fillOpacity:.1,radius:1e3}).addTo(map),L.marker(t,{icon:L.icon({iconAnchor:[10,36],iconSize:[20,38],iconUrl:"https://i.imgur.com/vXd4IW8.png",popupAnchor:[0,-38]})}).addTo(map))},async initStations(){var t=await this.getStations();const a=L.icon({iconAnchor:[18,36],iconSize:[36,36],iconUrl:"https://i.imgur.com/1KRTaAO.png",popupAnchor:[0,-38]});L.markerClusterGroup({chunkedLoading:!0,disableClusteringAtZoom:16,spiderfyOnMaxZoom:!1}).addLayers(_.map(t,t=>L.marker([t.lat,t.lng],{icon:a}).bindPopup(stationToPopup(t),{minWidth:200}))).addTo(map)},async getCsv(t,a=3e4){t=_.trim(_.get(await axios.get(t,{params:{cachebust:_.floor(Date.now()/a)}}),"data"));return _.get(Papa.parse(t,{encoding:"utf8",header:!0}),"data",[])},parseJsonOrDefault(t,a){try{return JSON.parse(t)}catch(t){return a}}}});</script></body></html>