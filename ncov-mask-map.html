<!doctype html><html><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>武漢肺炎藥局口罩地圖</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-39556213-3");</script><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><meta content="顯示您附近的藥局，方便您前往購買口罩，遠離武漢肺炎！" name="description"><meta content="顯示您附近的藥局，方便您前往購買口罩，遠離武漢肺炎！" property="og:description"><meta content="https://taichunmin.idv.tw/images/works/ncov-mask-map.png?v=1" property="og:image"><meta content="武漢肺炎藥局口罩地圖" property="og:title"><meta content="website" property="og:type"><meta content="https://taichunmin.idv.tw/pug/ncov-mask-map.html" property="og:url"><link href="https://cdn.jsdelivr.net/npm/leaflet@1/dist/leaflet.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1/dist/MarkerCluster.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1/dist/MarkerCluster.Default.css" rel="stylesheet"><style>[v-cloak]{display:none}#app,body,html{height:100%;width:100vw}.leaflet-popup-content{font-size:14px}.leaflet-popup-content h6{font-size:18px;margin-bottom:1rem}.leaflet-popup-content .table-store th{white-space:nowrap}.leaflet-popup-content .table-store td{text-align:right}.leaflet-popup-content .table-time th{background-color:#d6d8db}</style></head><body><div id="app" v-cloak></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/leaflet@1/dist/leaflet.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1/dist/leaflet.markercluster.min.js" crossorigin="anonymous"></script><script>const httpBuildQuery=(t,e={})=>Qs.stringify(t,{arrayFormat:"brackets",...e}),storeToIcon=(()=>{const t=L.Icon.extend({options:{iconAnchor:[18,36],iconSize:[36,36],popupAnchor:[0,-38]}}),e={green:new t({iconUrl:"https://i.imgur.com/1KRTaAO.png"}),red:new t({iconUrl:"https://i.imgur.com/Ed6iMMC.png"}),unknown:new t({iconUrl:"https://i.imgur.com/mfATTxs.png"}),yellow:new t({iconUrl:"https://i.imgur.com/raxi9vh.png"})};return t=>{if(!t.mask_updated)return e.unknown;t=(_.min([t.adult,600])+_.min([t.child,200]))/800;return t<.2?e.red:t<.5?e.yellow:e.green}})(),storeToPopup=t=>`<h6>${t.name}</h6>
<table class="table table-sm table-borderless table-store text-monospace">
  ${(t=>t.mask_updated?`<tr><th>口罩</th><td>成人 ${t.adult} / 兒童 ${t.child}</td></tr>
    <tr><th>時間</th><td>${t.mask_updated}</td></tr>`:"<tr><th>口罩</th><td>無資料</td></tr>")(t)}
  <tr><th>電話</th><td><a href="tel:${t.tel}">${t.tel}</a></td></tr>
  <tr><th>地址</th><td>${t.address}</td></tr>
  <tr><th>備註</th><td>${t.notice}</td></tr>
</table>
<table class="table table-sm table-bordered text-center table-time">${(a=>{const t=["<tr><th>　</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th><th>日</th></tr>"];var o=["上","下","晚"];for(let e=0;e<3;e++){const r=[`<th>${o[e]}</th>`];for(let t=0;t<7;t++)"1"===a[7*e+t]?r.push('<td class="table-success"><i class="fa fa-check"></i></td>'):r.push('<td class="table-danger"><i class="fa fa-times"></i></td>');t.push("<tr>"+r.join("")+"</tr>")}return t.join("")})(t.time)}</table>
<a class="btn btn-dark btn-block text-white mt-3" href="${(t=>{const e={api:1,destination:t.lat+","+t.lng,openExternalBrowser:1,travelmode:"walking"};return _.isString(t.place_id)&&t.place_id&&(e.destination_place_id=t.place_id),"https://www.google.com/maps/dir/?"+httpBuildQuery(e)})(t)}" role="button" target="_blank">
  Google 導航
</a>`,[DEFAULT_LAT,DEFAULT_LNG,DEFAULT_ZOOM]=[25.040857,121.567904,15];let map;const vm=new Vue({el:"#app",data:()=>({src:"https://docs.google.com/spreadsheets/d/e/2PACX-1vT4tWc7zUcHQQ8LC_0276aOZNcIBu544YB9XrSRz7oq66q5lE3RHN5Ix2-4S3NL4bL-0zi5nKzE13eX/pub?gid=1109820539&single=true&output=csv"}),async mounted(){await this.init()},methods:{async init(){this.initMap(),this.initStores(),this.showNews()},async showNews(){var t,e="ncov-mask-map-news-timestamp",a=+new Date(2020,9,15,0,0,0);a<=_.parseInt(localStorage.getItem(e))||(t=await Swal.fire({cancelButtonText:"與開發者聯絡",confirmButtonText:"我知道了",icon:"info",reverseButtons:!0,showCancelButton:!0,html:`<div style="font-size: .9rem">
        <p>ℹ️&nbsp;&nbsp;10/15 因為口罩恢復定額徵用，本地圖已經調整為展示模式。</p>
        </div>`}),localStorage.setItem(e,a),t.value||(location.href="https://fb.me/taichunmin"))},async initStores(){var t=_.map(await this.getStores(),t=>L.marker([t.lat,t.lng],{icon:storeToIcon(t)}).bindPopup(storeToPopup(t),{minWidth:200}));map.addLayer(L.markerClusterGroup({chunkedLoading:!0,disableClusteringAtZoom:16,spiderfyOnMaxZoom:!1}).addLayers(t))},async getStores(){var t=await this.getCsv(this.src);return window.stores=t,_.filter(t,t=>(t.lat=_.toNumber(t.lat),t.lng=_.toNumber(t.lng),t.adult=_.toInteger(t.adult),t.child=_.toInteger(t.child),_.inRange(t.lat,21,28)&&_.inRange(t.lng,117,123)))},async initMap(){var t;map||(t=L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attribution">CARTO</a>'}),map=L.map("app",{center:[DEFAULT_LAT,DEFAULT_LNG],zoom:DEFAULT_ZOOM,layers:[t]}),await this.locate())},async locate(){var t=await new Promise(e=>{map.locate({setView:!0}).on("locationfound",t=>{e(t.latlng)}).on("locationerror",t=>{e(L.latLng(DEFAULT_LAT,DEFAULT_LNG))})});map.setZoom(DEFAULT_ZOOM),L.circle(t,{stroke:!1,fillColor:"#00beff",fillOpacity:.2,radius:300}).addTo(map),L.circle(t,{stroke:!1,fillColor:"#00beff",fillOpacity:.1,radius:1e3}).addTo(map),L.marker(t,{icon:L.icon({iconAnchor:[10,36],iconSize:[20,38],iconUrl:"https://i.imgur.com/vXd4IW8.png",popupAnchor:[0,-38]})}).addTo(map)},async getCsv(t,e=3e4){t=_.trim(_.get(await axios.get(t,{params:{cachebust:_.floor(Date.now()/e)}}),"data"));return _.get(Papa.parse(t,{encoding:"utf8",header:!0}),"data",[])}}});</script></body></html>