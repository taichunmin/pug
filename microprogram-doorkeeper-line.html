<!doctype html><html><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>微程式刷卡通知人工審核</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-39556213-3" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-39556213-3");</script><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><meta content="2133031763635285" property="fb:app_id"><meta content="微程式刷卡通知人工審核" property="og:description"><meta content="zh_TW" property="og:locale"><meta content="筆記國度" property="og:site_name"><meta content="微程式刷卡通知人工審核" property="og:title"><meta content="website" property="og:type"><meta content="https://liff.line.me/1655633310-Y3EoMePD" property="og:url"><style>[v-cloak]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,body,h1,h2,h3,h4,h5,h6{font-family:"Noto Sans TC",sans-serif}.input-group-prepend .input-group-text{letter-spacing:-1px;min-width:6rem}</style></head><body><div class="container-fluid my-3" id="app" v-cloak v-if="ready"><h3 class="mb-3 text-center">微程式刷卡通知人工審核</h3><div class="text-monospace was-validated"><div class="mt-2 input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-end">lihi</span></div><input class="form-control" pattern="https://.+" required type="url" v-model="h.lihi" inputmode="url"></div><div class="mt-2 input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-end">callback</span></div><input class="form-control" pattern="https://.+" required type="url" v-model="h.callback" inputmode="url"></div><div class="mt-2 input-group input-group-sm"><div class="input-group-prepend"><span class="input-group-text justify-content-end">secret</span></div><input class="form-control" pattern="[0-9a-zA-Z]{43}" required type="password" v-model="h.secret"></div><div class="mt-2 form-group"><label>員工編號 (uid)</label><div class="input-group input-group-sm"><input class="form-control" pattern="[0-9-]{3,}" required type="tel" v-model="h.uid" inputmode="tel"><div class="input-group-append"><span class="input-group-text">{{ _.get(employees, [h.uid], '未知') }}</span></div></div></div><div class="mt-2 input-group input-group-sm"><input class="form-control" :value="urlRegister" @click="btnCopy(urlRegister)" readonly><div class="input-group-append"><button @click="btnCopy(urlRegister)" class="btn align-items-center btn-outline-secondary d-flex justify-content-center" type="button"><i class="fa fa-clipboard mr-2"></i> 複製網址</button></div></div></div><div class="mx-n1 row"><div class="col px-1"><button @click="btnReset" class="mt-2 btn btn-block btn-danger" type="button"><i class="fa fa-fw fa-trash-o"></i> 清除資料</button></div><div class="col px-1"><button @click="btnShare" class="mt-2 btn btn-block btn-success" type="button"><i class="fa fa-fw fa-paper-plane-o"></i> 傳送連結</button></div></div><div class="mx-n1 row"><div class="col px-1"><a class="mt-2 btn btn-block btn-outline-dark" href="https://line.me/R/nv/addFriends" target="_blank"><i class="fa fa-fw fa-address-card"></i> 加入好友</a></div><div class="col px-1"><a class="mt-2 btn btn-block btn-outline-dark" href="https://line.me/R/nv/QRCodeReader" target="_blank"><i class="fa fa-fw fa-qrcode"></i> 掃碼加友</a></div></div></div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/json5@2/dist/index.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-core.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1/plugins/autoloader/prism-autoloader.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" crossorigin="anonymous"></script><script src="https://static.line-scdn.net/liff/edge/2/sdk.js" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/crypto-js@4/crypto-js.min.js" crossorigin="anonymous"></script><script>const loginPromise=(async()=>{if(await liff.init({liffId:"1655633310-Y3EoMePD"}),!liff.isLoggedIn())return liff.login({redirectUri:location.href}),new Promise(e=>{});var e=await liff.getProfile().catch(()=>({}));if(e.userId)return window.gtagSetLineId&&window.gtagSetLineId(e.userId),e;throw new Error("無法取得 userId")})(),encodeBase64url=e=>(_.isInteger(e.sigBytes)||(e=CryptoJS.enc.Utf8.parse(""+e)),CryptoJS.enc.Base64.stringify(e).replace(/[+/=]/g,e=>_.get({"+":"-","/":"_","=":""},e))),hs256Base64url=(e,t)=>{if(!_.isString(e))throw new Error("invalid msg");if(_.isString(t)&&t)return encodeBase64url(CryptoJS.HmacSHA256(e,t));throw new Error("invalid secret")};window.vm=new Vue({el:"#app",data:{ready:!1,employees:null,h:{callback:"https://us-central1-mp-parking-lot.cloudfunctions.net/gcf-doorkeeper-line-http/linenotify",lihi:"https://lihi1.com/q4kAj",secret:"",uid:""}},async mounted(){await loginPromise;try{var e=JSON5.parse(localStorage.getItem(location.pathname));e&&this.$set(this,"h",{...this.h,...e})}catch(e){}this.$watch("h",()=>{localStorage.setItem(location.pathname,JSON5.stringify(this.h))},{deep:!0}),this.employees=await this.getEmployees(),this.ready=!0},computed:{urlRegister(){var e=JSON5.stringify({uid:this.h.uid,callback:this.h.callback}),t=_.get(this,"h.secret");return t?`${this.h.lihi}/${encodeBase64url(e)}.`+hs256Base64url(e,t):"請輸入 secret"}},methods:{async getCsv(e,t=3e4){e=_.trim(_.get(await axios.get(e,{params:{cachebust:_.floor(Date.now()/t)}}),"data"));return _.get(Papa.parse(e,{encoding:"utf8",header:!0}),"data",[])},async getEmployees(){var e=await this.getCsv("https://gist.githubusercontent.com/taichunmin/705dae98222ebb6c2b6be9d5d30f3765/raw/doorkeeper-employees.csv");return _.fromPairs(_.map(e,e=>[e.uid,e.name]))},async btnReset(e=!0){if(!e||(e=await Swal.fire({cancelButtonColor:"#3085d6",cancelButtonText:"保持原樣",confirmButtonColor:"#d33",confirmButtonText:"重設紀錄",focusCancel:!0,icon:"warning",showCancelButton:!0,text:"是否重設本頁面的紀錄？"})).value)return localStorage.removeItem(location.pathname),location.reload(),new Promise(e=>{})},async btnShare(){try{if(await loginPromise,!liff.isApiAvailable("shareTargetPicker"))throw new Error("不支援 shareTargetPicker，請嘗試更新應用程式版本。");var e=await liff.shareTargetPicker(this.getRenderedMsgs());if("success"!==_.get(e,"status"))throw new Error("已取消傳送");await Swal.fire({icon:"success",title:"傳送成功"})}catch(e){console.error(e),await Swal.fire({icon:"error",title:"傳送失敗",text:e.message})}},async btnCopy(e,t=null){t=t||document.body;const i=document.createElement("textarea");i.value=e,t.appendChild(i),i.select(),i.setSelectionRange(0,1e6),document.execCommand("copy"),t.removeChild(i),await Swal.fire({icon:"success",title:"複製成功"})},getRenderedMsgs(){let e={type:"bubble",body:{layout:"vertical",spacing:"md",type:"box",contents:[{size:"lg",text:_.get(this.employees,this.h.uid,this.h.uid)+"你好：",type:"text",weight:"bold"},{size:"sm",text:"以下是您專屬的設定連結，點選此連結代表您同意本服務獲取必要之個人資料，本連結不會失效，請勿轉貼給他人使用。",type:"text",wrap:!0}]},footer:{layout:"vertical",spacing:"md",type:"box",contents:[{color:"#E2231A",style:"primary",type:"button",action:{label:"點此開啟刷卡通知",type:"uri",uri:this.urlRegister}},{color:"#6c757d",style:"primary",type:"button",action:{label:"點此取消刷卡通知",type:"uri",uri:"https://notify-bot.line.me/my/"}}]},header:{backgroundColor:"#E2231A",layout:"vertical",type:"box",contents:[{layout:"horizontal",type:"box",contents:[{flex:1,layout:"vertical",type:"box",contents:[]},{cornerRadius:"50px",flex:0,height:"100px",layout:"vertical",type:"box",width:"100px",contents:[{aspectMode:"cover",aspectRatio:"1:1",backgroundColor:"#ffffff",gravity:"center",type:"image",url:"https://i.imgur.com/7F25dCI.png"}]},{flex:1,layout:"vertical",type:"box",contents:[]}]},{align:"center",color:"#ffffff",margin:"15px",size:"xxl",text:"微程式刷卡通知",type:"text",weight:"bold"}]}};return _.includes(["bubble","carousel"],_.get(e,"type"))&&(e={type:"flex",altText:"邀請您開啟微程式的刷卡通知服務。",contents:e}),_.isArray(e)||(e=[e]),console.log("msg =",e),e}}});</script></body></html>